# まるなげ経理 - 請求管理システム

## 概要

各税理士法人の出力行数を集計し、請求管理を行うシステム。

---

## シート構成

### 請求管理シート（けんごさん専用）

| タブ | 内容 |
|------|------|
| 税理士一覧 | 税理士法人の登録（シートID、単価等） |
| 月次集計 | 月ごとの出力行数と金額 |
| 請求履歴 | 請求書発行履歴（将来用） |

### 税理士一覧の列

| 列 | 内容 |
|---|---|
| A | 税理士法人名 |
| B | 顧客管理シートID |
| C | コードプレフィックス（KZ等） |
| D | 有効フラグ |
| E | 月額基本料金 |
| F | 単価（円/行） |
| G | メモ |

### 月次集計の列

| 列 | 内容 |
|---|---|
| A | 税理士法人名 |
| B | コード |
| C | 年月 |
| D | レシート行数 |
| E | 通帳行数 |
| F | 合計行数 |
| G | 単価 |
| H | 金額 |
| I | 集計日時 |

---

## 出力フラグの仕組み

### 各顧客スプシに追加する列

| 列 | 内容 |
|---|---|
| 出力済 | TRUE/FALSE |
| 出力日 | 出力実行日 |
| 出力行数 | 仕訳行数（税率ごと） |

### レシートの出力行数計算

```
出力行数 = 0
if 対象額(10%) > 0 → +1
if 対象額(8%) > 0 → +1
if 不課税 > 0 → +1
```

### 通帳の出力行数

常に 1

---

## 集計ロジック

1. 税理士一覧から有効な税理士を取得
2. 各税理士の顧客管理シートを開く
3. 各顧客のスプシを巡回
4. `出力済=TRUE` かつ `日付が該当月` の `出力行数` を合計
5. 月次集計シートに記録

---

## メニュー

| メニュー | 説明 |
|----------|------|
| 📊 月次集計を実行 | 当月の集計 |
| 📊 指定月の集計 | 任意の月を集計 |
| ⚙️ 初期セットアップ | シート作成 |

---

## セットアップ手順

1. 新しいスプレッドシートを作成（名前: `まるなげ経理_請求管理`）
2. スクリプトエディタを開く
3. `BillingManagement.gs` と `ExportFlagUtils.gs` を貼り付け
4. メニュー → `⚙️ 初期セットアップ`
5. 税理士一覧に税理士法人を登録

---

## 今後の拡張

- [ ] 請求書自動生成
- [ ] 請求書PDF出力
- [ ] メール自動送信
- [ ] Stripe連携（自動課金）
